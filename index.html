<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ai L√† Tri·ªáu Ph√∫ - Dragon Storm Edition</title>
    <style>
        /* --- 1. C·∫§U H√åNH CHUNG --- */
        :root {
            --primary-bg: #0f0c15;
            --gold-gradient: linear-gradient(to bottom, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --bronze-texture: #2b1d0e;
            --blue-box: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
            
            /* --- ƒêI·ªÄU CH·ªàNH C·ª† CH·ªÆ T·∫†I ƒê√ÇY --- */
            --font-huge: clamp(4rem, 8vw, 9rem);      /* Ti√™u ƒë·ªÅ game */
            --font-big: clamp(2.5rem, 5vw, 6rem);     /* C√¢u h·ªèi (ƒê√£ tƒÉng l√™n) */
            --font-medium: clamp(1.8rem, 3.5vw, 4rem); /* ƒê√°p √°n (ƒê√£ tƒÉng l√™n) */
            
            --gold-color: #ffcc00;
        }

        body {
            font-family: 'Verdana', sans-serif;
            background: var(--primary-bg);
            color: #fff;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; margin: 0; overflow: hidden;
            user-select: none; perspective: 1000px;
            cursor: pointer;
        }

        .is-hidden { display: none !important; }

        /* --- BACKGROUND 3D --- */
        .bg-3d-container { position: fixed; inset: 0; pointer-events: none; z-index: 0; transform-style: preserve-3d; overflow: hidden; }
        .cube-floater {
            position: absolute; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1);
            transform-style: preserve-3d; animation: floatCube linear infinite;
        }
        .cube-floater::before, .cube-floater::after { content: ''; position: absolute; inset: 0; background: inherit; border: inherit; }
        .cube-floater::before { transform: translateZ(-20px); }
        .cube-floater::after { transform: rotateY(90deg) translateZ(-20px); }
        @keyframes floatCube {
            0% { transform: translateZ(-500px) rotate(0deg) translateY(100vh); opacity: 0; }
            20%, 80% { opacity: 1; }
            100% { transform: translateZ(200px) rotate(360deg) translateY(-20vh); opacity: 0; }
        }

        /* --- HI·ªÜU ·ª®NG S√âT (LIGHTNING) --- */
        #lightning-container {
            position: fixed; inset: 0; pointer-events: none; z-index: 5;
            overflow: hidden;
        }
        .lightning-bolt {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            fill: none; stroke: #fff; stroke-width: 3px;
            stroke-linecap: round; stroke-linejoin: round;
            filter: drop-shadow(0 0 10px #00ffff) drop-shadow(0 0 20px #fff);
            opacity: 0;
            animation: flashBolt 0.15s linear forwards;
        }
        @keyframes flashBolt {
            0% { opacity: 0; }
            10% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 0; }
        }

        /* --- HI·ªÜU ·ª®NG RUNG (RUMBLE) --- */
        .screen-explode-shake { animation: violentShake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes violentShake {
            0% { transform: translate(0, 0); }
            10% { transform: translate(-10px, -10px) rotate(-2deg); }
            30% { transform: translate(10px, 10px) rotate(2deg); }
            50% { transform: translate(-10px, 10px) rotate(-2deg); }
            70% { transform: translate(10px, -10px) rotate(2deg); }
            100% { transform: translate(0, 0); }
        }
        
        .rumble-active { animation: heavyGrind 0.1s infinite; }
        @keyframes heavyGrind {
            0% { transform: translate(0, 0); }
            25% { transform: translate(-2px, 2px); }
            50% { transform: translate(2px, -1px); }
            75% { transform: translate(-1px, -2px); }
            100% { transform: translate(0, 0); }
        }

        .impact-shake { animation: heavyImpact 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes heavyImpact {
            0% { transform: rotateY(-15deg) rotateX(5deg) translateY(0); }
            10% { transform: rotateY(-15deg) rotateX(5deg) translateY(40px); }
            30% { transform: rotateY(-15deg) rotateX(5deg) translateY(-20px); }
            50% { transform: rotateY(-15deg) rotateX(5deg) translateY(10px); }
            100% { transform: rotateY(-15deg) rotateX(5deg) translateY(0); }
        }

        .flash-overlay { position: fixed; inset: 0; background: #fff; z-index: 4000; opacity: 0; pointer-events: none; mix-blend-mode: overlay; }
        .flash-active { animation: flashBang 0.6s ease-out forwards; }
        @keyframes flashBang { 0% { opacity: 1; } 100% { opacity: 0; } }

        /* --- UI BUTTONS --- */
        .btn-action {
            cursor: pointer; font-size: 1.2rem; padding: 15px 40px; margin: 20px;
            border-radius: 50px; border: 2px solid #fff; background: var(--gold-gradient); color: #2c1b05;
            font-weight: 900; text-transform: uppercase; box-shadow: 0 10px 20px rgba(0,0,0,0.5); transition: all 0.2s;
            z-index: 100; position: relative;
        }
        .btn-action:hover { transform: translateY(-2px); filter: brightness(1.1); box-shadow: 0 0 20px #ffcc00; }
        .btn-secondary { background: #444; color: #fff; border-color: #999; }
        
        /* --- FULL SCREEN BUTTON --- */
        .btn-fullscreen {
            position: fixed; top: 20px; left: 20px; width: 50px; height: 50px;
            background: rgba(0,0,0,0.6); border: 2px solid rgba(255,255,255,0.5); border-radius: 50%;
            display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 9999;
            transition: all 0.3s;
        }
        .btn-fullscreen:hover { background: rgba(255, 204, 0, 0.3); border-color: #ffcc00; box-shadow: 0 0 15px #ffcc00; }
        .btn-fullscreen svg { width: 24px; height: 24px; fill: #fff; filter: drop-shadow(0 0 2px #000); }

        .btn-next-external {
            position: fixed; bottom: 2vh; right: 2vw; width: clamp(60px, 8vw, 90px); height: clamp(60px, 8vw, 90px);
            background: radial-gradient(circle at 30% 30%, #ff4444, #990000); color: #fff; border: 3px solid #fff; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; text-decoration: none; font-weight: bold; z-index: 9999;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); animation: pulseBtn 2s infinite;
        }
        @keyframes pulseBtn { 0% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); } }

        .screen-container {
            position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column;
            justify-content: center; align-items: center; transition: all 0.6s ease; transform-style: preserve-3d; z-index: 10;
        }
        .slide-out-left { transform: translateX(-150%) rotateY(-20deg); opacity: 0; pointer-events: none; }
        .slide-in-right { transform: translateX(150%) rotateY(20deg); opacity: 0; pointer-events: none; }
        .slide-center { transform: translateX(0) rotateY(0); opacity: 1; pointer-events: auto; }

        /* --- WHEEL --- */
        .wheel-wrapper-3d { perspective: 1000px; position: relative; z-index: 50; }
        .wheel-container {
            width: 65vw; height: 45vh; background: #000; border: 15px solid #333; border-radius: 10px;
            overflow: hidden; position: relative; transform: rotateX(10deg); transform-style: preserve-3d;
            box-shadow: 0 50px 50px rgba(0,0,0,0.8), inset 0 0 80px rgba(0,0,0,1); transition: border-color 0.3s, box-shadow 0.3s;
        }
        .wheel-container.spinning { border-color: #ffcc00; box-shadow: 0 50px 80px rgba(255, 100, 0, 0.3), inset 0 0 40px #ff4400; animation: shake 0.04s infinite; }
        @keyframes shake { 0% { transform: rotateX(10deg) translate(1px, 1px); } 50% { transform: rotateX(10deg) translate(-1px, -1px); } 100% { transform: rotateX(10deg) translate(1px, 1px); } }
        .spark-spin {
            position: absolute; width: 6px; height: 20px; background: #fff; border-radius: 2px; pointer-events: none; z-index: 200;
            will-change: transform, opacity; box-shadow: 0 0 5px #ffff00, 0 0 15px #ff0000; mix-blend-mode: screen;
        }
        .wheel-pointer {
            position: absolute; top: 50%; left: -20px; right: -20px; height: 18%;
            transform: translateY(-50%) translateZ(30px);
            background: linear-gradient(to bottom, rgba(240, 173, 78, 0.15), rgba(240, 173, 78, 0) 50%, rgba(240, 173, 78, 0.15));
            border-top: 3px solid var(--gold-color); border-bottom: 3px solid var(--gold-color); z-index: 6; backdrop-filter: blur(2px);
        }
        #names-list { list-style: none; padding: 0; margin: 0; transform-style: preserve-3d; }
        #names-list li { 
            height: 8vh; display: flex; align-items: center; justify-content: center;
            font-size: var(--font-big); font-weight: 900; text-transform: uppercase;
            color: #888; text-shadow: 0 2px 2px rgba(0,0,0,0.8); transform: scale(0.9); opacity: 0.6;
        }

        /* --- MONEY LADDER (BIGGER & CLEARER) --- */
        #money-screen { perspective: 1500px; } 
        .money-card {
            background: rgba(10, 10, 20, 0.95); border: 2px solid #444; border-radius: 20px;
            height: 85vh; width: clamp(500px, 70vw, 850px);
            padding: 10px 0;
            transform: rotateY(-15deg) rotateX(5deg); transform-style: preserve-3d;
            box-shadow: -50px 50px 100px rgba(0,0,0,0.8);
            overflow: hidden; position: relative; display: flex; flex-direction: column; justify-content: flex-end;
        }
        .money-scroll-wrapper {
            width: 100%; max-height: 100%; overflow-y: auto; scrollbar-width: none; -ms-overflow-style: none;
            display: flex; flex-direction: column-reverse; padding-top: 100px; padding-bottom: 20px;
        }
        .money-scroll-wrapper::-webkit-scrollbar { display: none; }
        .money-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column-reverse; width: 100%; transform-style: preserve-3d; }
        .money-list li {
            width: 90%; margin: 8px auto; padding: 12px 30px;
            display: flex; justify-content: space-between; align-items: center;
            font-size: clamp(1.2rem, 2.5vh, 2.2rem);
            color: #666; background: rgba(255,255,255,0.05);
            border: 1px solid #333; border-radius: 10px; transform: translateZ(0px); box-shadow: 0 5px 10px rgba(0,0,0,0.3);
            transition: all 0.3s; flex-shrink: 0; position: relative;
        }
        .money-list li.safe { color: #eee; border-color: #888; }
        .money-list li.safe .money-idx { color: var(--gold-color); }
        .money-list li.active {
            background: linear-gradient(90deg, #b87418, #f0ad4e, #b87418); color: #000 !important; font-weight: 900;
            border: 3px solid #fff; transform: translateZ(50px) scale(1.15);
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.8), 0 0 10px #ffcc00; z-index: 100;
            animation: flashBorder 0.5s; 
        }
        @keyframes flashBorder { 0% { border-color: #fff; } 50% { border-color: #ffff00; } 100% { border-color: #fff; } }

        .jump-slam-anim { animation: jumpUpDrop 0.6s cubic-bezier(0.7, -0.4, 0.4, 1.4) forwards; z-index: 200; }
        @keyframes jumpUpDrop {
            0% { transform: translateZ(0) scale(0.95); }
            50% { transform: translateZ(100px) translateY(-40px) scale(1.1); } 
            80% { transform: translateZ(80px) translateY(0) scale(1.2); } 
            100% { transform: translateZ(80px) translateY(0) scale(1.2); } 
        }
        
        .ladder-shockwave {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 100%; height: 100%; border-radius: 15px;
            box-shadow: 0 0 50px rgba(255, 255, 255, 1), inset 0 0 20px rgba(255,255,255,0.8); 
            border: 8px solid #fff; opacity: 0; z-index: 150; pointer-events: none;
            mix-blend-mode: overlay;
        }
        .ladder-shockwave-active { animation: ladderWave 0.5s ease-out forwards; }
        @keyframes ladderWave {
            0% { transform: translate(-50%, -50%) scale(0.9); opacity: 1; border-width: 10px; }
            100% { transform: translate(-50%, -50%) scale(1.6, 3); opacity: 0; border-width: 0px; }
        }
        
        .ladder-spark {
            position: absolute; width: 6px; height: 30px; background: #fff;
            box-shadow: 0 0 10px #ffcc00, 0 0 20px #ff4400; 
            border-radius: 4px; z-index: 300; pointer-events: none;
        }
        .steam-puff {
            position: absolute; width: 80px; height: 80px; background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(200,200,200,0) 70%);
            border-radius: 50%; pointer-events: none; z-index: 200; opacity: 0;
        }

        /* --- WINNER & GRAND GATE EFFECT --- */
        #winner-overlay {
            position: fixed; inset: 0; background: radial-gradient(circle, rgba(20, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.95) 100%);
            z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(2px); 
        }
        #winner-name-big { 
            font-size: clamp(4rem, 9vw, 10rem); font-weight: 900; text-transform: uppercase;
            color: transparent; -webkit-text-stroke: 2px #ffcc00; position: relative; z-index: 3500; opacity: 0;
        }
        .fire-mode {
            background: linear-gradient(0deg, #ff0000 0%, #ff8800 50%, #ffff00 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; -webkit-text-stroke: 0px transparent !important;
            text-shadow: 0 0 10px #ff0000, 0 -5px 20px #ff8800, 0 -10px 40px #ffcc00;
            animation: firePulse 0.1s infinite alternate; filter: drop-shadow(0 0 10px #ff0000);
        }
        @keyframes firePulse { 0% { transform: scale(1); } 100% { transform: scale(1.02); } }
        .winner-dead-drop { animation: superHeavyDrop 0.4s cubic-bezier(0.6, 0, 1, 1) forwards; }
        @keyframes superHeavyDrop { 0% { transform: translateY(-150vh) scale(3); opacity: 0; } 100% { transform: translateY(0) scale(1); opacity: 1; } }
        
        .glass-shard {
            position: absolute; top: 50%; left: 50%; transform-origin: center;
            background: linear-gradient(135deg, rgba(255, 200, 0, 0.9), rgba(255, 100, 0, 0.6));
            border: 1px solid #fff; box-shadow: 0 0 15px #ff4500; z-index: 3200; opacity: 0; pointer-events: none; mix-blend-mode: screen;
        }
        .ember-particle {
            position: absolute; width: 4px; height: 4px; background: #fff; border-radius: 50%;
            box-shadow: 0 0 5px #ffcc00, 0 0 10px #ff0000; pointer-events: none; z-index: 3600;
        }
        @keyframes riseEmber { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-200px) translateX(var(--drift)) scale(0); opacity: 0; } }
        
        /* --- C·ªîNG R·ªíNG VƒÇN H√ìA (ROYAL BRONZE GATE - DONG SON) --- */
        #grand-gate {
            position: fixed; inset: 0; width: 100%; height: 100%; pointer-events: none; z-index: 3200; 
            display: flex;
        }
        .gate-panel {
            width: 50%; height: 100%; position: relative;
            background: radial-gradient(ellipse at center, #2d1f1a 0%, #1a120b 50%, #0d0806 100%);
            border-top: 15px solid #6b4f3b;
            border-bottom: 15px solid #6b4f3b;
            box-shadow: inset 0 0 200px rgba(0,0,0,0.9), inset 0 10px 40px rgba(139,90,43,0.3), inset 0 -10px 40px rgba(139,90,43,0.3), 0 0 100px rgba(0,0,0,0.9);
            /* Th·ªùi gian m·ªü SI√äU CH·∫¨M: 10s */
            transition: transform 10s cubic-bezier(0.1, 0.7, 0.3, 1); 
            will-change: transform; overflow: hidden;
        }

        /* L·ªõp H·ªça Ti·∫øt ƒê·ªìng S∆°n Ch√¨m */
        .gate-panel::before {
            content: ''; position: absolute; inset: 0; opacity: 0.4;
            background-image: 
                repeating-radial-gradient(circle at 50% 50%, #4a3428 0px, #4a3428 3px, transparent 4px, transparent 25px),
                repeating-radial-gradient(circle at 30% 30%, #3e2723 0px, #3e2723 2px, transparent 3px, transparent 40px),
                repeating-radial-gradient(circle at 70% 70%, #3e2723 0px, #3e2723 2px, transparent 3px, transparent 40px),
                conic-gradient(from 0deg at 50% 50%, transparent 0deg, #5d4037 8deg, transparent 16deg),
                linear-gradient(90deg, transparent 48%, #3e2723 49%, #3e2723 51%, transparent 52%),
                linear-gradient(0deg, transparent 48%, #3e2723 49%, #3e2723 51%, transparent 52%);
            background-size: 300px 300px, 250px 250px, 250px 250px, 100% 100%, 60px 100%, 100% 60px;
            background-position: center;
            background-repeat: repeat, no-repeat, no-repeat, no-repeat, center, center;
            mix-blend-mode: overlay;
            animation: subtleShimmer 8s ease-in-out infinite alternate;
        }
        @keyframes subtleShimmer { 0% { opacity: 0.35; } 100% { opacity: 0.5; } }
        
        .gate-panel::after {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(ellipse at 50% 50%, transparent 0%, rgba(0,0,0,0.7) 70%, rgba(0,0,0,0.95) 100%);
        }
        
        .gate-left { transform: translateX(-105%); border-right: 6px solid #8a6d3b; }
        .gate-right { transform: translateX(105%); border-left: 6px solid #8a6d3b; }

        /* ƒê√≥ng nhanh (1.2s) */
        .gate-closed .gate-left { transform: translateX(0%); transition: transform 1.2s cubic-bezier(0.6, 0, 0.2, 1); }
        .gate-closed .gate-right { transform: translateX(0%); transition: transform 1.2s cubic-bezier(0.6, 0, 0.2, 1); }

        /* --- ƒê·∫¶U R·ªíNG UY NGHI (ROYAL DRAGON SVG) --- */
        .dragon-knocker {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 45vw; height: 45vw; max-width: 350px; max-height: 350px;
            z-index: 20;
            filter: drop-shadow(10px 15px 10px rgba(0,0,0,0.9)) drop-shadow(-5px -5px 5px rgba(255,255,255,0.05));
        }
        .gate-left .dragon-knocker { right: -5%; } 
        .gate-right .dragon-knocker { left: -5%; transform: translateY(-50%) scaleX(-1); }

        .dk-body { fill: url(#goldGradient); stroke: #2b1d0e; stroke-width: 1px; }
        .dk-detail { fill: #4e342e; opacity: 0.7; }
        .dk-eye { fill: #000; animation: eyeGlow 3s infinite alternate; }
        .dk-ring { fill: none; stroke: url(#goldGradient); stroke-width: 15px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5)); }
        
        @keyframes eyeGlow {
            0% { fill: #330000; filter: drop-shadow(0 0 0px red); }
            100% { fill: #ff0000; filter: drop-shadow(0 0 20px red); }
        }

        /* S√≥ng xung k√≠ch */
        .gate-shockwave {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 100vh; height: 100vh; border-radius: 50%;
            border: 40px solid #ffcc00; opacity: 0; z-index: 3300; pointer-events: none;
            mix-blend-mode: screen;
        }
        .impact-active .gate-shockwave { animation: shockwaveExpand 1.0s ease-out forwards; }
        @keyframes shockwaveExpand {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; border-width: 50px; }
            100% { transform: translate(-50%, -50%) scale(2); opacity: 0; border-width: 0px; }
        }

        /* L·ª≠a t√≥e */
        .spark-impact {
            position: absolute; width: 5px; height: 80px; background: #fff;
            top: 50%; left: 50%; transform-origin: center bottom;
            z-index: 3350; pointer-events: none; opacity: 0;
            box-shadow: 0 0 20px #ffaa00;
        }

        /* Khe s√°ng */
        .gate-glow {
            position: absolute; top: 0; left: 50%; width: 12px; height: 100%;
            background: #fff; box-shadow: 0 0 150px 60px #ffcc00;
            z-index: 3250; opacity: 0; transform: translateX(-50%); transition: opacity 0.5s;
        }
        .gate-closed .gate-glow { opacity: 1; transition-delay: 1.0s; }

        /* Chaos Smoke */
        .chaos-smoke {
            position: absolute; border-radius: 50%;
            background: radial-gradient(circle, rgba(240,240,240,0.8) 0%, rgba(255,255,255,0) 70%);
            z-index: 3400; pointer-events: none; filter: blur(8px);
        }

        .tap-to-continue {
            color: #ffcc00; font-size: 1.2rem; margin-top: 60px; opacity: 0;
            animation: blinkText 2s infinite; pointer-events: none; text-shadow: 0 0 10px #ff0000;
        }
        .tap-visible { opacity: 1; transition: opacity 1s 1s; }
        @keyframes blinkText { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        /* --- RESULT SCREEN --- */
        #result-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.96); z-index: 3000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .result-box {
            background: var(--blue-box); border: 4px solid var(--gold-color); padding: 5vh 2vw;
            border-radius: 30px; text-align: center; width: 90vw; max-width: 1200px;
            transform: rotateX(5deg); box-shadow: 0 30px 80px rgba(0,0,0,1);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .result-title {
            font-size: clamp(3rem, 6vw, 5rem); font-weight: 900; margin-bottom: 10px; 
            color: #ff3333; text-transform: uppercase; text-shadow: 0 0 20px #ff0000;
            -webkit-text-stroke: 1px #fff;
        }
        .result-name {
            font-size: clamp(2.5rem, 5vw, 4rem); color: #fff; font-weight: 900; 
            margin: 20px 0; text-transform: uppercase; text-shadow: 0 2px 5px rgba(0,0,0,0.8);
        }
        #res-score { font-size: clamp(1.5rem, 3vw, 2.5rem); color: #ccc; margin-bottom: 20px; font-weight: bold; }
        .result-money { 
            font-size: clamp(5rem, 15vw, 12rem); font-weight: 900; margin: 30px 0;
            background: linear-gradient(to bottom, #fff, #ffcc00, #b8860b);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 20px rgba(255, 204, 0, 0.5)); animation: pulseMoney 2s infinite ease-in-out;
        }
        @keyframes pulseMoney {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 20px rgba(255, 204, 0, 0.5)); }
            50% { transform: scale(1.05); filter: drop-shadow(0 0 40px rgba(255, 204, 0, 0.8)); }
        }

        #ranking-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .ranking-table { width: 90vw; border-collapse: collapse; margin: 2vh 0; font-size: var(--font-medium); border: 1px solid var(--gold-color); }
        .ranking-table th { background: var(--gold-color); color: #000; padding: 15px; }
        .ranking-table td { border: 1px solid #555; padding: 10px; text-align: center; color: #fff; }
        
        #quiz-screen { width: 95vw; height: 100vh; display: flex; flex-direction: column; padding: 2vh 0; z-index: 20; position: relative; }
        .question-box {
            background: var(--blue-box); border: 2px solid var(--gold-color); padding: 0 4vw; margin: 0 auto 3vh auto; width: 90vw; flex: 1.2;
            display: flex; justify-content: center; align-items: center; text-align: center; clip-path: polygon(5% 0%, 95% 0%, 100% 50%, 95% 100%, 5% 100%, 0% 50%);
        }
        #question-text { font-size: var(--font-big); font-weight: bold; text-shadow: 2px 2px 0 #000; color: #fff; line-height: 1.3; }
        .answers-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2vh 4vw; height: 40vh; width: 90vw; margin: 0 auto; }
        .answer-btn {
            background: var(--blue-box); color: white; border: none; font-size: var(--font-medium); padding: 0 3vw 0 1vw; cursor: pointer;
            display: flex; align-items: center; clip-path: polygon(5% 0%, 95% 0%, 100% 50%, 95% 100%, 5% 100%, 0% 50%); transition: opacity 0.5s, visibility 0.5s;
        }
        .answer-btn.correct { background: #006400 !important; }
        .answer-btn.incorrect { background: #550000 !important; }
        .answer-btn.removed { opacity: 0; visibility: hidden; pointer-events: none; }

    </style>
</head>
<body>
    <div id="bg-3d" class="bg-3d-container"></div>
    <div id="lightning-container"></div> <div id="flash-screen" class="flash-overlay"></div>
    
    <div class="btn-fullscreen" onclick="toggleFullScreen()" title="To√†n m√†n h√¨nh">
        <svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
    </div>

    <div id="grand-gate">
        <div class="gate-panel gate-left">
            <svg class="dragon-knocker" viewBox="0 0 200 200">
                <defs>
                    <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#f2d06b;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#b8860b;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#704214;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <circle cx="100" cy="130" r="40" class="dk-ring" />
                <path class="dk-body" d="M50,50 L70,30 L100,10 L130,30 L150,50 L160,90 L140,120 L100,140 L60,120 L40,90 Z" />
                <path class="dk-body" d="M50,50 Q30,20 40,0 M150,50 Q170,20 160,0" stroke-width="5" fill="none" />
                <path class="dk-eye" d="M65,70 L85,65 L85,75 Z" />
                <path class="dk-eye" d="M135,70 L115,65 L115,75 Z" />
                <path class="dk-detail" d="M90,100 Q100,110 110,100 L100,90 Z" />
                <path class="dk-detail" d="M80,120 Q100,130 120,120" stroke="#3e2723" stroke-width="4" fill="none"/>
            </svg>
        </div>
        <div class="gate-panel gate-right">
            <svg class="dragon-knocker" viewBox="0 0 200 200">
                <defs>
                    <linearGradient id="goldGradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#f2d06b;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#b8860b;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#704214;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <circle cx="100" cy="130" r="40" class="dk-ring" style="stroke:url(#goldGradient2)" />
                <path class="dk-body" style="fill:url(#goldGradient2)" d="M50,50 L70,30 L100,10 L130,30 L150,50 L160,90 L140,120 L100,140 L60,120 L40,90 Z" />
                <path class="dk-body" style="stroke:url(#goldGradient2)" d="M50,50 Q30,20 40,0 M150,50 Q170,20 160,0" stroke-width="5" fill="none" />
                <path class="dk-eye" d="M65,70 L85,65 L85,75 Z" />
                <path class="dk-eye" d="M135,70 L115,65 L115,75 Z" />
                <path class="dk-detail" d="M90,100 Q100,110 110,100 L100,90 Z" />
                <path class="dk-detail" d="M80,120 Q100,130 120,120" stroke="#3e2723" stroke-width="4" fill="none"/>
            </svg>
        </div>
        <div class="gate-glow"></div>
        <div class="gate-shockwave"></div>
    </div>

    <a href="ket_thuc.html" class="btn-next-external" target="_blank" title="Chuy·ªÉn web">NEXT &#10148;</a>
    
    <audio id="sound-bg" loop><source src="https://www.soundjay.com/misc/sounds/wind-chime-1.mp3" type="audio/mpeg"></audio>
    <audio id="sound-correct"><source src="https://www.soundjay.com/human/sounds/applause-01.mp3" type="audio/mpeg"></audio>
    <audio id="sound-boom"><source src="https://www.soundjay.com/mechanical/sounds/glass-break-1.mp3" type="audio/mpeg"></audio>
    <audio id="sound-wrong"><source src="https://www.soundjay.com/misc/sounds/fail-buzzer-01.mp3" type="audio/mpeg"></audio>
    <audio id="sound-slam"><source src="https://www.soundjay.com/human/sounds/footstep-concrete-jump-1.mp3" type="audio/mpeg"></audio>
    <audio id="sound-whoosh"><source src="https://www.soundjay.com/nature/sounds/whip-whoosh-01.mp3" type="audio/mpeg"></audio>

    <div id="spinner-screen" class="screen-container slide-center">
        <h1 style="color: var(--gold-color); font-size: var(--font-huge); text-shadow: 0 5px 10px #000; margin: 0; transform: translateZ(50px);">AI L√Ä TRI·ªÜU PH√ö</h1>
        <div class="wheel-wrapper-3d" id="wheel-wrapper">
            <div class="wheel-container"><div class="wheel-pointer"></div><ul id="names-list"></ul></div>
        </div>
        <button class="btn-action" id="spin-btn" onclick="spinWheel()">QUAY NGAY</button>
    </div>

    <div id="winner-overlay" class="is-hidden">
        <h2 style="color: #aaa; font-size: var(--font-medium); margin-bottom: 50px; opacity: 0.8;">NG∆Ø·ªúI ƒê∆Ø·ª¢C CH·ªåN</h2>
        <div id="winner-name-container">
            <div id="winner-name-big">T√äN</div>
            <div id="shockwave" class="winner-shockwave"></div>
            <div id="cracks-container" style="position: absolute; top: 50%; left: 50%; width: 0; height: 0;"></div>
        </div>
        <div id="tap-guide" class="tap-to-continue">CH·∫†M V√ÄO M√ÄN H√åNH ƒê·ªÇ TI·∫æP T·ª§C</div>
    </div>

    <div id="ranking-overlay" class="is-hidden">
        <h1 style="color: var(--gold-color); font-size: var(--font-big);">üèÜ B·∫¢NG VINH DANH üèÜ</h1>
        <table class="ranking-table">
            <thead><tr><th>H·∫°ng</th><th>T√™n</th><th>K·∫øt qu·∫£</th><th>Ti·ªÅn th∆∞·ªüng</th></tr></thead>
            <tbody id="ranking-body"></tbody>
        </table>
        <div>
            <button class="btn-action" onclick="startFromRanking()">V√ÄO GAME</button>
            <button class="btn-action btn-secondary" onclick="resetRanking()">RESET B·∫¢NG</button>
            <button class="btn-action btn-secondary" onclick="clearPlayHistory()">RESET T·ª∂ L·ªÜ</button>
        </div>
    </div>

    <div id="money-screen" class="screen-container is-hidden">
        <div class="money-card" id="money-card-container">
            <div class="money-scroll-wrapper">
                <ul class="money-list" id="money-list"></ul>
            </div>
        </div>
    </div>

    <div id="quiz-screen" class="screen-container is-hidden">
        <div style="width:100%; display:flex; justify-content:flex-end; padding-right:2vw;">
            <button id="btn-5050" class="btn-action" style="border-radius:50%; width:80px; height:80px; padding:0; display:flex; align-items:center; justify-content:center;" onclick="use5050()">50:50</button>
        </div>
        <div class="question-box"><div id="question-text">...</div></div>
        <div class="answers-grid" id="answers-container"></div>
    </div>

    <div id="result-overlay" class="is-hidden">
        <div class="result-box">
            <div class="result-title" id="res-title">...</div>
            <div class="result-name" id="res-name">...</div>
            <div id="res-score">...</div>
            <div class="result-money" id="res-money">0</div>
            <button class="btn-action" onclick="location.reload()">V·ªÄ TRANG CH·ª¶</button>
        </div>
    </div>

    <script>
        // --- FULL SCREEN LOGIC ---
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        const names = ["Thu√Ω Anh", "K·ª≥ Anh", "Vi·ªát Anh", "Ph∆∞∆°ng Anh", "B·∫Øc", "C√∫c", "Dung", "ƒêƒÉng", "H√†", "Hi·ªáp", "H·ªìng", "Nguy·ªÖn Huy", "D∆∞∆°ng H∆∞∆°ng", "Ki·ªÅu", "Lan", "Ho√†ng Ly", "Nguy·ªÖn Ly", "Tr√† Mai", "Xu√¢n Mai", "Minh", "Nam", "Ni√™n", "Nguy·ªÖn Ph∆∞∆°ng", "V≈© Ph∆∞∆°ng", "Thanh", "Th√†nh", "Thu", "Th√πy", "Th√∫y", "Tr∆∞·ªüng", "Tuy√™n", "Tuy·∫øt"];
        const baseMoneyLevels = ["200.000", "400.000", "600.000", "1.000.000", "2.000.000", "3.000.000", "6.000.000", "10.000.000", "14.000.000", "22.000.000", "30.000.000", "40.000.000", "60.000.000", "85.000.000", "150.000.000"];
        let moneyLevels = [], safeLevels = []; 
        const questionsData = [
            { q: "T√°c ph·∫©m ‚ÄúMu·ªëi c·ªßa r·ª´ng‚Äù ƒë∆∞·ª£c vi·∫øt b·ªüi t√°c gi·∫£ n√†o?", o: ["T√¥ Ho√†i", "Nguy·ªÖn Minh Ch√¢u", "Nguy·ªÖn Huy Thi·ªáp", "Ma VƒÉn Kh√°ng"], c: 2 },
            { q: "Ngh·ªÅ nghi·ªáp c·ªßa √¥ng Di·ªÉu l√† g√¨?", o: ["ChƒÉn th·∫£ gia s√∫c", "L√†m n∆∞∆°ng r·∫´y", "ƒêi sƒÉn", "L√†m g·ªó"], c: 2 },
            { q: "Lo√†i v·∫≠t xu·∫•t hi·ªán trong truy·ªán l√† g√¨?", o: ["Kh·ªâ", "V∆∞·ª£n", "H·ªï", "Nai"], c: 1 },
            { q: "S·ª± ki·ªán m·ªü ƒë·∫ßu truy·ªán l√† g√¨?", o: ["Tr·∫≠n ch√°y r·ª´ng", "√îng Di·ªÉu v·ªÅ b·∫£n", "√îng Di·ªÉu g·∫∑p con v∆∞·ª£n ƒë·ª±c", "V∆∞·ª£n c√°i c·ª©u √¥ng Di·ªÉu"], c: 2 },
            { q: "V√¨ sao con v∆∞·ª£n ƒë·ª±c ch·∫øt?", o: ["B·ªã th√∫ r·ª´ng t·∫•n c√¥ng", "B·ªã l·ª≠a thi√™u", "B·ªã ng∆∞·ªùi d√¢n b·∫Øn", "B·ªã √¥ng Di·ªÉu b·∫Øn nh·∫ßm"], c: 3 },
            { q: "Con v∆∞·ª£n c√°i ƒë√£ l√†m g√¨ khi th·∫•y con v∆∞·ª£n ƒë·ª±c ch·∫øt?", o: ["T·∫•n c√¥ng √¥ng Di·ªÉu", "Tru l√™n ƒëau ƒë·ªõn v√† √¥m x√°c b·∫°n", "B·ªè ch·∫°y v√†o r·ª´ng", "K√™u g·ªçi ƒë√†n v∆∞·ª£n kh√°c"], c: 1 },
            { q: "Con v∆∞·ª£n c√°i ƒë√£ ph√° ƒëi·ªÅu g√¨ c·ªßa √¥ng Di·ªÉu?", o: ["L·ªÅu tr√∫", "H√≤m ƒë·ªì", "B·∫´y th√∫", "S√∫ng"], c: 2 },
            { q: "Cao tr√†o c·ªßa truy·ªán l√† s·ª± ki·ªán n√†o?", o: ["Con v∆∞·ª£n c√°i ph√° b·∫´y", "Ch√°y r·ª´ng v√† v∆∞·ª£n c·ª©u ng∆∞·ªùi", "√îng Di·ªÉu ƒë·∫∑t b·∫´y", "V∆∞·ª£n c√°i nh√¨n √¥ng Di·ªÉu"], c: 1 },
            { q: "‚ÄúMu·ªëi c·ªßa r·ª´ng‚Äù trong truy·ªán c√≥ √Ω nghƒ©a bi·ªÉu t∆∞·ª£ng cho:", o: ["Th·ª©c ƒÉn c·ªßa th√∫ r·ª´ng", "B·ªánh r·ª´ng", "Gi√° tr·ªã tinh th·∫ßn t·ª´ thi√™n nhi√™n", "M·ªôt lo·∫°i c√¢y ƒë·∫∑c bi·ªát"], c: 2 },
            { q: "Truy·ªán ng·∫Øn thu·ªôc th·ªÉ lo·∫°i:", o: ["H·ªìi k√≠", "T√πy b√∫t", "Truy·ªán ng·∫Øn hi·ªán ƒë·∫°i", "K√≠ s·ª±"], c: 2 },
            { q: "H√†nh ƒë·ªông ph√° b·∫´y c·ªßa v∆∞·ª£n c√°i th·ªÉ hi·ªán ƒëi·ªÅu g√¨?", o: ["S·ª± th√π h·∫±n mu·ªën gi·∫øt ng∆∞·ªùi", "S·ª± th√¥ng minh v√† c·∫£nh b√°o", "S·ª± ho·∫£ng lo·∫°n", "B·∫£n nƒÉng sinh t·ªìn"], c: 1 },
            { q: "V√¨ sao √¥ng Di·ªÉu c·∫£m th·∫•y t·ªôi l·ªói?", o: ["V√¨ m·∫•t ƒë·ªì", "V√¨ nghƒ© m√¨nh ƒë·∫∑t b·∫´y sai", "V√¨ b·∫Øn ch·∫øt con v∆∞·ª£n ƒë·ª±c v√¥ c·ªõ", "V√¨ b·ªã v∆∞·ª£n c√°i theo d√µi"], c: 2 },
            { q: "Trong truy·ªán, thi√™n nhi√™n ƒë∆∞·ª£c kh·∫Øc h·ªça ch·ªß y·∫øu b·∫±ng bi·ªán ph√°p n√†o?", o: ["Nh√¢n h√≥a", "So s√°nh", "Ho√°n d·ª•", "N√≥i qu√°"], c: 0 },
            { q: "S·ª± hi sinh c·ªßa v∆∞·ª£n c√°i cho th·∫•y ph·∫©m ch·∫•t g√¨?", o: ["Con v·∫≠t c√≥ l√≤ng bao dung", "Con v·∫≠t ngu ng·ªëc", "Con v·∫≠t hung h√£n", "Con v·∫≠t th√≠ch b√°o th√π"], c: 0 },
            { q: "T∆∞ t∆∞·ªüng ch·ªß ƒë·∫°o c·ªßa t√°c ph·∫©m l√† g√¨?", o: ["Khuy√™n con ng∆∞·ªùi ƒÉn chay", "Ph√™ ph√°n c√°c th·ª£ sƒÉn", "T√¥n vinh mu·ªëi c·ªßa r·ª´ng", "Ca ng·ª£i thi√™n nhi√™n v√† l∆∞∆°ng tri"], c: 3 },
            { q: "√ù nghƒ©a c·ªßa t√¨nh hu·ªëng truy·ªán ‚Äúcon v·∫≠t c·ª©u k·∫ª gi·∫øt b·∫°n m√¨nh‚Äù:", o: ["T·∫°o kh√¥ng kh√≠ h√†i h∆∞·ªõc", "T·∫°o b∆∞·ªõc ngo·∫∑t nh·∫≠n th·ª©c", "L√†m tƒÉng s·ªë l∆∞·ª£ng nh√¢n v·∫≠t", "K√©o d√†i di·ªÖn bi·∫øn"], c: 1 },
            { q: "V√¨ sao r·ª´ng ƒë∆∞·ª£c g·ªçi l√† ‚Äúm·ªôt th·∫ø gi·ªõi v·ª´a g·∫Øn b√≥ v·ª´a xa l·∫°‚Äù?", o: ["V√¨ √¥ng Di·ªÉu kh√¥ng hi·ªÉu h·∫øt r·ª´ng", "V√¨ r·ª´ng kh√¥ng c√≥ s·ª± s·ªëng", "V√¨ r·ª´ng lu√¥n ch√†o ƒë√≥n con ng∆∞·ªùi", "V√¨ r·ª´ng to√†n th√∫ d·ªØ"], c: 0 },
            { q: "H√¨nh ·∫£nh v∆∞·ª£n c√°i nh√¨n √¥ng Di·ªÉu t·ª´ xa mang √Ω nghƒ©a:", o: ["R√¨nh t·∫•n c√¥ng", "Mu·ªën k·∫øt b·∫°n", "S·ª± ƒëau ƒë·ªõn v√† tr√°ch m√≥c", "S·ª£ h√£i"], c: 2 },
            { q: "T·∫°i sao truy·ªán c√≥ t√™n ‚ÄúMu·ªëi c·ªßa r·ª´ng‚Äù?", o: ["V√¨ r·ª´ng c√≥ mu·ªëi th·∫≠t", "V√¨ mu·ªëi l√† th·ª©c ƒÉn cho th√∫", "T∆∞·ª£ng tr∆∞ng cho gi√° tr·ªã nh√¢n b·∫£n", "V√¨ √¥ng Di·ªÉu ƒëi l·∫•y mu·ªëi"], c: 2 },
            { q: "Truy·ªán kh·∫Øc h·ªça s·ª± ƒë·ªïi thay n√†o ·ªü √¥ng Di·ªÉu?", o: ["T·ª´ t·ª± tin ‚Üí ki√™u ng·∫°o", "T·ª´ v√¥ c·∫£m ‚Üí nh√¢n t√≠nh", "T·ª´ y·∫øu ƒëu·ªëi ‚Üí m·∫°nh m·∫Ω", "T·ª´ gi·∫≠n d·ªØ ‚Üí vui v·∫ª"], c: 1 },
            { q: "B√†i h·ªçc l·ªõn nh·∫•t m√† √¥ng Di·ªÉu nh·∫≠n ra l√† g√¨?", o: ["R·ª´ng nhi·ªÅu th√∫ d·ªØ", "Ng∆∞·ªùi th·ª£ sƒÉn ph·∫£i b·∫Øn ch√≠nh x√°c", "Thi√™n nhi√™n c√≥ t√¨nh nghƒ©a", "Kh√¥ng n√™n ƒëi r·ª´ng m·ªôt m√¨nh"], c: 2 },
            { q: "N·∫øu thi·∫øu t√¨nh hu·ªëng con v∆∞·ª£n c·ª©u ng∆∞·ªùi, truy·ªán m·∫•t y·∫øu t·ªë g√¨?", o: ["Cao tr√†o v√† gi√° tr·ªã nh√¢n vƒÉn", "S·ª± xu·∫•t hi·ªán c·ªßa d√¢n b·∫£n", "M√¢u thu·∫´n k·ªãch t√≠nh", "Mi√™u t·∫£ r·ª´ng"], c: 0 },
            { q: "T√°c ph·∫©m g·ª≠i ƒë·∫øn th√¥ng ƒëi·ªáp n√†o cho con ng∆∞·ªùi?", o: ["C·∫ßn m·∫°nh m·∫Ω tr∆∞·ªõc thi√™n nhi√™n", "S·ªëng h√≤a h·ª£p, t√¥n tr·ªçng mu√¥n lo√†i", "SƒÉn b·∫Øt ƒë·ªÉ t·ªìn t·∫°i", "N√™n d√πng nhi·ªÅu b·∫´y h∆°n"], c: 1 },
            { q: "S·ª± ƒë·ªëi l·∫≠p gi·ªØa ‚Äúgi·∫øt‚Äù v√† ‚Äúc·ª©u‚Äù nh·∫±m nh·∫•n m·∫°nh:", o: ["S·ª± may m·∫Øn c·ªßa √¥ng Di·ªÉu", "Quy lu·∫≠t b√°o ·ª©ng", "S·ª©c m·∫°nh c·ªßa l√≤ng bao dung", "Quy lu·∫≠t t·ª± nhi√™n"], c: 2 },
            { q: "V∆∞·ª£n c√°i c√≥ th·ªÉ ƒë∆∞·ª£c xem nh∆∞ bi·ªÉu t∆∞·ª£ng c·ªßa:", o: ["S·ª± tr·∫£ th√π c·ªßa t·ª± nhi√™n", "S·ª± h·ªßy di·ªát thi√™n nhi√™n", "L√≤ng nh√¢n √°i c·ªßa thi√™n nhi√™n", "S·ª± ho·∫£ng lo·∫°n c·ªßa lo√†i v·∫≠t"], c: 2 },
            { q: "H√†nh ƒë·ªông v∆∞·ª£n c√°i ph√° b·∫´y c√≥ th·ªÉ hi·ªÉu l√†:", o: ["L·ªùi c·∫£nh b√°o cho √¥ng Di·ªÉu", "Mu·ªën ph√° r·ª´ng", "T√≠nh ngh·ªãch ng·ª£m c·ªßa v∆∞·ª£n", "S·ª± n√¥ng n·ªïi c·ªßa n√≥"], c: 0 },
            { q: "Ch·ªçn nh·∫≠n x√©t ƒë√∫ng nh·∫•t v·ªÅ nh√¢n v·∫≠t √¥ng Di·ªÉu:", o: ["√îng l√† ng∆∞·ªùi ƒë·ªôc √°c", "√îng v√¥ c·∫£m t·ª´ ƒë·∫ßu ƒë·∫øn cu·ªëi", "Bi·∫øt th·ª©c t·ªânh v√† h·ªëi l·ªói", "√îng th√π h·∫±n lo√†i v∆∞·ª£n"], c: 2 },
            { q: "D√≤ng n√†o n√≥i ƒë√∫ng nh·∫•t v·ªÅ √Ω nghƒ©a c·ªßa truy·ªán?", o: ["Kh·∫≥ng ƒë·ªãnh s·ª©c m·∫°nh con ng∆∞·ªùi", "S·ª± giao c·∫£m ng∆∞·ªùi v√† thi√™n nhi√™n", "Ph√™ ph√°n th√∫ d·ªØ r·ª´ng xanh", "Ca ng·ª£i sƒÉn b·∫Øn"], c: 1 },
            { q: "Chi ti·∫øt v∆∞·ª£n c√°i hi sinh cho th·∫•y th√¥ng ƒëi·ªáp g√¨?", o: ["R·ª´ng c·∫ßn ƒë∆∞·ª£c b·∫£o v·ªá", "R·ª´ng kh√¥ng quan tr·ªçng", "R·ª´ng n√™n b·ªã khai th√°c nhanh h∆°n", "R·ª´ng ch·ªâ d√†nh cho th√∫"], c: 0 },
            { q: "T√™n truy·ªán ‚ÄúMu·ªëi c·ªßa r·ª´ng‚Äù gi√∫p hi·ªÉu r·∫±ng:", o: ["Thi√™n nhi√™n c√≥ v·ªã m·∫∑n th·∫≠t", "R·ª´ng l√† n∆°i nguy hi·ªÉm", "R·ª´ng d·∫°y gi√° tr·ªã tinh th·∫ßn b·ªÅn v·ªØng", "ƒêi r·ª´ng ph·∫£i mang theo mu·ªëi"], c: 2 }
        ];

        let currentPlayer = "", currentQIndex = -1, currentQuestions = [], isLocked = false, sparkInterval, emberInterval;
        let isWinnerWaitState = false; 

        function getPlayedHistory() { return JSON.parse(localStorage.getItem('altp_played_history') || '{}'); }
        function savePlayedHistory(h) { localStorage.setItem('altp_played_history', JSON.stringify(h)); }
        function clearPlayHistory() { localStorage.removeItem('altp_played_history'); alert("ƒê√£ reset t·ª∑ l·ªá!"); }
        function pickWinnerWithWeight() {
            const history = getPlayedHistory();
            let weightedPool = [];
            names.forEach(name => {
                let count = history[name] || 0;
                let tickets = (count === 0) ? 50 : 1;
                for(let i = 0; i < tickets; i++) weightedPool.push(name);
            });
            const winner = weightedPool[Math.floor(Math.random() * weightedPool.length)];
            history[winner] = (history[winner] || 0) + 1;
            savePlayedHistory(history);
            return winner;
        }
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function generateMoneyLevels() {
            const totalQ = questionsData.length;
            moneyLevels = [];
            for(let i = 0; i < totalQ; i++) {
                if (i < baseMoneyLevels.length) {
                    moneyLevels.push(baseMoneyLevels[i]);
                } else {
                    let lastVal = parseInt(baseMoneyLevels[baseMoneyLevels.length - 1].replace(/\./g, ''));
                    let newVal = lastVal + ((i - baseMoneyLevels.length + 1) * 50000000);
                    moneyLevels.push(newVal.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."));
                }
            }
            safeLevels = []; for(let i = 4; i < totalQ; i+=5) safeLevels.push(i);
        }

        function initBackground3D() {
            const container = document.getElementById('bg-3d');
            for(let i=0; i<15; i++) {
                const cube = document.createElement('div'); cube.className = 'cube-floater';
                const size = Math.random() * 50 + 20; cube.style.width = size + 'px'; cube.style.height = size + 'px';
                cube.style.left = Math.random() * 100 + 'vw'; cube.style.animationDuration = (Math.random() * 10 + 10) + 's';
                cube.style.animationDelay = (Math.random() * -20) + 's'; container.appendChild(cube);
            }
        }

        function init() {
            initBackground3D(); generateMoneyLevels();
            const ul = document.getElementById('names-list'); ul.innerHTML = ''; 
            for(let i=0; i<5; i++) names.forEach(n => { let li = document.createElement('li'); li.textContent = n; ul.appendChild(li); });
            const ml = document.getElementById('money-list'); ml.innerHTML = '';
            moneyLevels.forEach((m, i) => {
                let li = document.createElement('li'); li.innerHTML = `<span class="money-idx">${i+1}</span> <span class="money-val">${m}</span>`;
                li.dataset.idx = i; if(safeLevels.includes(i)) li.classList.add('safe'); ml.appendChild(li);
            });
            if(!localStorage.getItem('altp_ranking')) localStorage.setItem('altp_ranking', '[]');
        }
        init();

        // H√ÄM TI·ªÜN √çCH: D·ª™NG RUNG & S√âT
        function stopShaking() {
            document.body.classList.remove('rumble-active');
            document.body.classList.remove('screen-explode-shake');
            document.getElementById('lightning-container').innerHTML = ''; // X√≥a s√©t
            const gate = document.getElementById('grand-gate');
            if(gate) {
                gate.classList.remove('impact-active');
                gate.classList.remove('gate-closed'); 
            }
        }

        /* --- T·∫†O S√âT (LIGHTNING) --- */
        function spawnLightningBolt() {
            const container = document.getElementById('lightning-container');
            // T·∫°o t·ªça ƒë·ªô ng·∫´u nhi√™n cho s√©t
            let pathData = `M ${Math.random() * 100} 0`; // ƒêi·ªÉm b·∫Øt ƒë·∫ßu
            let steps = 10;
            let currentX = Math.random() * 100;
            let currentY = 0;
            
            for (let i = 1; i <= steps; i++) {
                currentY += 100 / steps;
                currentX += (Math.random() - 0.5) * 30; // G√£y kh√∫c ng·∫´u nhi√™n
                pathData += ` L ${currentX} ${currentY}`;
            }

            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("class", "lightning-bolt");
            svg.setAttribute("viewBox", "0 0 100 100");
            svg.setAttribute("preserveAspectRatio", "none");

            const path = document.createElementNS(svgNS, "path");
            path.setAttribute("d", pathData);
            path.setAttribute("vector-effect", "non-scaling-stroke"); // Gi·ªØ ƒë·ªô d√†y n√©t

            svg.appendChild(path);
            container.appendChild(svg);

            // T·ª± x√≥a sau khi ch·ªõp t·∫Øt
            setTimeout(() => { svg.remove(); }, 200); 
        }

        function triggerLightningStorm() {
            // ƒê√°nh 5-8 tia s√©t ng·∫´u nhi√™n trong 1 gi√¢y
            let stormInterval = setInterval(() => {
                spawnLightningBolt();
            }, 100);

            setTimeout(() => { clearInterval(stormInterval); }, 800);
        }

        function spinWheel() {
            document.getElementById('spin-btn').disabled = true;
            try { document.getElementById('sound-bg').play(); } catch(e){}
            currentPlayer = pickWinnerWithWeight();
            const nameIndexInArray = names.indexOf(currentPlayer);
            const stopSetIndex = 3; const finalIndex = (stopSetIndex * names.length) + nameIndexInArray;
            const wheelContainer = document.querySelector('.wheel-container'); wheelContainer.classList.add('spinning');
            sparkInterval = setInterval(createSpinSparks, 40); 
            const itemHeight = wheelContainer.clientHeight / 5; 
            const stopPos = (finalIndex * itemHeight) - (wheelContainer.clientHeight / 2) + (itemHeight / 2);
            const ul = document.getElementById('names-list');
            ul.style.transition = 'transform 6s cubic-bezier(0.25, 0.1, 0.25, 1)'; ul.style.transform = `translateY(-${stopPos}px)`;
            setTimeout(() => {
                clearInterval(sparkInterval); document.getElementById('sound-bg').pause();
                wheelContainer.classList.remove('spinning'); celebrateWinner(currentPlayer);
            }, 6100); 
        }

        function createSpinSparks() {
            const wrapper = document.getElementById('wheel-wrapper'); const rect = wrapper.getBoundingClientRect();
            for(let i=0; i < 4; i++) {
                const spark = document.createElement('div'); spark.className = 'spark-spin';
                const isLeft = Math.random() > 0.5; const startX = isLeft ? rect.width * 0.15 : rect.width * 0.85; const startY = rect.height/2 + (Math.random() * 30 - 15);
                spark.style.left = startX + 'px'; spark.style.top = startY + 'px';
                const angle = (isLeft ? 0 : Math.PI) + (Math.random() * Math.PI/3 - Math.PI/6);
                spark.style.transform = `rotate(${angle}rad)`; wrapper.appendChild(spark);
                spark.animate([{ transform: `translate(0,0) rotate(${angle}rad) scale(1)`, opacity: 1 }, { transform: `translate(${Math.cos(angle)*300}px, ${Math.sin(angle)*300}px) rotate(${angle}rad) scale(0)`, opacity: 0 }], { duration: 400 }).onfinish = () => spark.remove();
            }
        }
        function createSteamEffect(element) {
            const rect = element.getBoundingClientRect(); const container = document.getElementById('money-screen');
            for(let i=0; i<10; i++) {
                const puff = document.createElement('div'); puff.className = 'steam-puff';
                puff.style.left = (rect.left + rect.width/2) + 'px'; puff.style.top = (rect.top + rect.height/2) + 'px';
                container.appendChild(puff);
                puff.animate([{ transform: 'translate(-50%,-50%) scale(0)', opacity: 0.8 }, { transform: `translate(${Math.random()*100-50}px, ${Math.random()*100-50}px) scale(2)`, opacity: 0 }], { duration: 800 }).onfinish = () => puff.remove();
            }
        }
        function createLadderSparks(rect) {
            const container = document.getElementById('money-screen');
            for(let i=0; i<30; i++) {
                const spark = document.createElement('div'); spark.className = 'ladder-spark';
                const offsetX = Math.random() * rect.width;
                spark.style.left = (rect.left + offsetX) + 'px'; spark.style.top = rect.bottom + 'px';
                container.appendChild(spark);
                const angle = (Math.PI / 2) + (Math.random() * 1 - 0.5); 
                const velocity = Math.random() * 150 + 50;
                spark.animate([{ transform: 'translate(0,0) scale(1)', opacity: 1 }, { transform: `translate(${Math.cos(angle)*velocity}px, ${Math.sin(angle)*velocity}px) scale(0)`, opacity: 0 }], { duration: 500 }).onfinish = () => spark.remove();
            }
        }
        function createGlassShards() {
            const container = document.getElementById('cracks-container'); container.innerHTML = ''; 
            for(let i=0; i<30; i++) {
                const shard = document.createElement('div'); shard.className = 'glass-shard';
                container.appendChild(shard);
                const size = Math.random()*80+40; shard.style.width=size+'px'; shard.style.height=size+'px';
                const p1=`${Math.random()*50}% ${Math.random()*50}%`, p2=`${50+Math.random()*50}% ${Math.random()*50}%`, p3=`${50+Math.random()*50}% ${50+Math.random()*50}%`, p4=`${Math.random()*50}% ${50+Math.random()*50}%`;
                shard.style.clipPath=`polygon(${p1},${p2},${p3},${p4})`;
                const angle=Math.random()*6.28, vel=Math.random()*450+150;
                shard.animate([{transform:`translate(-50%,-50%) scale(0.2)`, opacity:0}, {transform:`translate(calc(-50% + ${Math.cos(angle)*vel}px), calc(-50% + ${Math.sin(angle)*vel}px)) scale(1) rotate(${Math.random()*360}deg)`, opacity:1}], {duration:700, fill:'forwards'});
            }
        }
        function spawnEmbers() {
            if(!isWinnerWaitState) return;
            const c = document.getElementById('winner-name-container');
            const ember = document.createElement('div'); ember.className = 'ember-particle';
            ember.style.left = `calc(50% + ${Math.random()*300 - 150}px)`; ember.style.top = `calc(50% + ${Math.random()*50}px)`;
            ember.style.setProperty('--drift', (Math.random()*100-50)+'px');
            document.getElementById('winner-overlay').appendChild(ember);
            ember.animate([{transform:'translateY(0) scale(1)', opacity:1}, {transform:'translateY(-200px) translateX(var(--drift)) scale(0)', opacity:0}], {duration:1500}).onfinish=()=>ember.remove();
        }

        function triggerGateSparks() {
            const gate = document.getElementById('grand-gate');
            const count = 30; 
            for(let i=0; i<count; i++) {
                const spark = document.createElement('div');
                spark.className = 'spark-impact';
                spark.style.top = Math.random() * 100 + '%';
                const angle = Math.random() * 180 - 90; 
                gate.appendChild(spark);
                spark.animate([
                    { transform: `rotate(${angle}deg) scaleY(1) translateY(0)`, opacity: 1 },
                    { transform: `rotate(${angle}deg) scaleY(0.5) translateY(${Math.random()*150 + 50}px)`, opacity: 0 }
                ], { duration: 400 + Math.random()*300, easing: 'ease-out' }).onfinish = () => spark.remove();
            }
        }

        function spawnChaosSmoke() {
            const overlay = document.getElementById('winner-overlay');
            const count = 25; 
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;

            for(let i=0; i<count; i++) {
                const smoke = document.createElement('div');
                smoke.className = 'chaos-smoke';
                const size = Math.random() * 100 + 50; 
                smoke.style.width = size + 'px'; smoke.style.height = size + 'px';
                smoke.style.left = (centerX - size/2) + 'px';
                smoke.style.top = (centerY - size/2) + 'px';
                overlay.appendChild(smoke);

                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 400 + 150; 
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;

                smoke.animate([
                    { transform: 'translate(0, 0) scale(0.2)', opacity: 0.8 },
                    { transform: `translate(${tx}px, ${ty}px) scale(2.5)`, opacity: 0 }
                ], { duration: 1500 + Math.random()*1000, easing: 'ease-out', fill: 'forwards' }).onfinish = () => smoke.remove();
            }
        }

        function celebrateWinner(name) {
            const overlay = document.getElementById('winner-overlay'); const nameEl = document.getElementById('winner-name-big');
            const shockwave = document.getElementById('shockwave'); const flash = document.getElementById('flash-screen');
            const tapGuide = document.getElementById('tap-guide'); const cracks = document.getElementById('cracks-container');
            
            nameEl.textContent = name; 
            nameEl.classList.remove('winner-dead-drop', 'fire-mode'); 
            nameEl.style.opacity = '0'; 
            shockwave.classList.remove('winner-shockwave-active'); flash.classList.remove('flash-active');
            tapGuide.classList.remove('tap-visible'); cracks.innerHTML = ''; 
            if(emberInterval) clearInterval(emberInterval);
            isWinnerWaitState = false; overlay.classList.remove('is-hidden');
            
            // --- 1. ƒê√ìNG C·ªîNG (GATE CLOSE) ---
            const gate = document.getElementById('grand-gate');
            gate.classList.add('gate-closed');
            document.body.classList.add('rumble-active'); // B·∫Øt ƒë·∫ßu rung
            triggerLightningStorm(); // S√âT ƒê√ÅNH KHI C·ª¨A ƒê√ìNG

            // Ch·ªù 1.2s (khi c·ª≠a ƒë√≥ng ho√†n to√†n)
            setTimeout(() => {
                // √Çm thanh va ch·∫°m m·∫°nh
                try { 
                    const slam = document.getElementById('sound-slam'); slam.volume = 1.0; slam.currentTime = 0; slam.play();
                } catch(e){}

                // Hi·ªáu ·ª©ng va ch·∫°m
                gate.classList.add('impact-active'); 
                triggerGateSparks(); 
                triggerLightningStorm(); // S√âT ƒê√ÅNH C√ö CH√ìT
                
                document.body.classList.add('screen-explode-shake'); 
                document.body.classList.remove('rumble-active'); // T·∫°m d·ª´ng rung li√™n t·ª•c

                setTimeout(() => {
                    gate.classList.remove('impact-active');
                    document.body.classList.remove('screen-explode-shake');
                }, 600);

            }, 1200);

            // --- 2. CH·ªú 3.5S (T·∫†O S·ª∞ B√ç ·∫®N) ---
            setTimeout(() => {
                // --- 3. M·ªû C·ªîNG (GATE OPEN - CH·∫¨M 10s) ---
                gate.classList.remove('gate-closed');
                document.body.classList.add('rumble-active'); // Rung l·∫°i khi m·ªü c·ª≠a
                // Kh√¥ng ƒë√°nh s√©t l√∫c m·ªü ƒë·ªÉ t·∫≠p trung v√†o t√™n

                // Ch·ªù c·ª≠a h√© ra m·ªôt ch√∫t r·ªìi m·ªõi th·∫£ ch·ªØ (2.5s)
                setTimeout(() => {
                    nameEl.style.opacity = '1';
                    try { const whoosh = document.getElementById('sound-whoosh'); whoosh.volume = 0.8; whoosh.currentTime = 0; whoosh.play(); } catch(e){}
                    
                    void nameEl.offsetWidth; nameEl.classList.add('winner-dead-drop');
                    
                    setTimeout(() => {
                        spawnChaosSmoke(); 

                        flash.classList.add('flash-active'); document.body.classList.add('screen-explode-shake');
                        triggerLightningStorm(); // S√âT ƒê√ÅNH KHI T√äN R∆†I

                        setTimeout(() => document.body.classList.remove('screen-explode-shake'), 500);
                        shockwave.classList.add('winner-shockwave-active'); createGlassShards(); nameEl.classList.add('fire-mode');
                        
                        try { 
                            const boom = document.getElementById('sound-boom'); boom.volume = 1.0; boom.currentTime = 0; boom.play(); 
                            const slam = document.getElementById('sound-slam'); slam.volume = 1.0; slam.currentTime = 0; slam.play(); 
                        } catch(e){} 
                        try { document.getElementById('sound-correct').play(); } catch(e){}
                        
                        isWinnerWaitState = true; tapGuide.classList.add('tap-visible'); emberInterval = setInterval(spawnEmbers, 100);
                    }, 350);
                }, 2500); 

                setTimeout(() => {
                     document.body.classList.remove('rumble-active');
                }, 10000); // T·∫Øt rung sau 10s

            }, 3500); 
        }

        // CLICK ƒê·ªÇ B·ªé QUA: D·ª™NG RUNG NGAY L·∫¨P T·ª®C
        document.addEventListener('click', function(e) {
            // Ignore clicks on the fullscreen button
            if (e.target.closest('.btn-fullscreen')) return;

            if(isWinnerWaitState) {
                isWinnerWaitState = false; if(emberInterval) clearInterval(emberInterval);
                document.getElementById('winner-overlay').classList.add('is-hidden'); 
                
                stopShaking(); // <--- QUAN TR·ªåNG: D·ª´ng m·ªçi rung l·∫Øc
                
                showRanking(true);
            }
        });

        function showRanking(show) {
            const overlay = document.getElementById('ranking-overlay');
            stopShaking(); // ƒê·∫£m b·∫£o d·ª´ng rung khi v√†o b·∫£ng x·∫øp h·∫°ng
            if(show) {
                const tbody = document.getElementById('ranking-body'); tbody.innerHTML = '';
                let data = JSON.parse(localStorage.getItem('altp_ranking') || '[]');
                if(data.length === 0) tbody.innerHTML = '<tr><td colspan="4">Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>';
                else { data.forEach((item, idx) => tbody.innerHTML += `<tr><td>${idx + 1}</td><td>${item.name}</td><td>${item.score}</td><td>${item.money}</td></tr>`); }
                overlay.classList.remove('is-hidden');
            } else { overlay.classList.add('is-hidden'); }
        }
        function startFromRanking() { showRanking(false); startGame(); }
        function resetRanking() { if(confirm("X√≥a b·∫£ng x·∫øp h·∫°ng?")) { localStorage.removeItem('altp_ranking'); showRanking(true); } }

        function startGame() {
            stopShaking(); // ƒê·∫£m b·∫£o s·∫°ch s·∫Ω tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu
            let shuffledQs = shuffle([...questionsData]);
            currentQuestions = shuffledQs.map(q => {
                const correctAnswerText = q.o[q.c]; const shuffledOptions = shuffle([...q.o]);
                return { q: q.q, o: shuffledOptions, c: shuffledOptions.indexOf(correctAnswerText) };
            });
            currentQIndex = -1; const spinner = document.getElementById('spinner-screen');
            spinner.classList.remove('slide-center'); spinner.classList.add('slide-out-left');
            
            document.body.classList.add('screen-explode-shake');
            triggerLightningStorm(); // S√âT ƒê√ÅNH KHI START GAME
            setTimeout(() => document.body.classList.remove('screen-explode-shake'), 500);

            setTimeout(() => { spinner.classList.add('is-hidden'); nextLevel(); }, 600);
        }

        function nextLevel() {
            currentQIndex++; if (currentQIndex >= currentQuestions.length) { gameOver(true); return; }
            if (currentQIndex > 0) showMoneyAnimation(); else showQuizScreenDirectly();
        }

        function showMoneyAnimation() {
            const ms = document.getElementById('money-screen'); const qs = document.getElementById('quiz-screen');
            qs.classList.add('is-hidden'); qs.classList.remove('slide-center');
            ms.classList.remove('is-hidden', 'slide-out-left', 'slide-center'); ms.classList.add('slide-in-right');
            
            // Rung m√†n h√¨nh nh·∫π khi chuy·ªÉn c·∫£nh
            document.body.classList.add('screen-explode-shake');
            triggerLightningStorm(); // S√âT ƒê√ÅNH KHI HI·ªÜN TI·ªÄN
            setTimeout(() => document.body.classList.remove('screen-explode-shake'), 500);

            try { const whoosh = document.getElementById('sound-whoosh'); whoosh.volume = 0.6; whoosh.currentTime = 0; whoosh.play(); } catch(e){}

            document.querySelectorAll('#money-list li').forEach(li => {
                li.classList.remove('active', 'jump-slam-anim'); const oldWave = li.querySelector('.ladder-shockwave'); if(oldWave) oldWave.remove();
            });
            const cardContainer = document.getElementById('money-card-container');
            cardContainer.classList.remove('impact-shake');

            setTimeout(() => {
                ms.classList.remove('slide-in-right'); ms.classList.add('slide-center');
                setTimeout(() => {
                    const curLi = document.querySelector(`li[data-idx="${currentQIndex}"]`);
                    if(curLi) { 
                        curLi.scrollIntoView({behavior: "smooth", block: "center"});
                        setTimeout(() => {
                            curLi.classList.add('jump-slam-anim'); 
                            
                            setTimeout(() => {
                                try { 
                                    const slam = document.getElementById('sound-slam'); slam.volume = 1.0; slam.currentTime = 0; slam.play();
                                    const boom = document.getElementById('sound-boom'); boom.volume = 0.8; boom.currentTime = 0; boom.play();
                                } catch(e){}
                                
                                cardContainer.classList.add('impact-shake');
                                createSteamEffect(curLi); 
                                createLadderSparks(curLi.getBoundingClientRect());
                                curLi.classList.add('active');
                                const shock = document.createElement('div'); shock.className = 'ladder-shockwave ladder-shockwave-active';
                                curLi.appendChild(shock); setTimeout(() => shock.remove(), 600);

                            }, 400); 
                        }, 300); 
                    }
                }, 600);
                setTimeout(() => {
                    ms.classList.remove('slide-center'); ms.classList.add('slide-out-left');
                    setTimeout(() => { ms.classList.add('is-hidden'); ms.classList.remove('slide-out-left'); showQuizScreenDirectly(); }, 1500); 
                }, 4500);
            }, 50);
        }

        function showQuizScreenDirectly() {
            const qs = document.getElementById('quiz-screen'); loadQuestionUI();
            qs.classList.remove('is-hidden', 'slide-out-left', 'slide-center'); qs.classList.add('slide-in-right');
            
            // Rung m√†n h√¨nh nh·∫π khi chuy·ªÉn c·∫£nh
            document.body.classList.add('screen-explode-shake');
            triggerLightningStorm(); // S√âT ƒê√ÅNH KHI V√ÄO C√ÇU H·ªéI
            setTimeout(() => document.body.classList.remove('screen-explode-shake'), 500);

            setTimeout(() => { qs.classList.remove('slide-in-right'); qs.classList.add('slide-center'); }, 50);
        }
        function loadQuestionUI() {
            isLocked = false; const q = currentQuestions[currentQIndex];
            document.getElementById('question-text').textContent = q.q;
            const grid = document.getElementById('answers-container'); grid.innerHTML = '';
            const labels = ["A", "B", "C", "D"];
            q.o.forEach((opt, i) => {
                const btn = document.createElement('button'); btn.className = 'answer-btn';
                btn.innerHTML = `<span>${labels[i]}:</span> ${opt}`; btn.onclick = () => checkAnswer(i, q.c, btn); grid.appendChild(btn);
            });
            const btn5050 = document.getElementById('btn-5050');
            if(btn5050.dataset.used === "true") { btn5050.disabled = true; btn5050.style.opacity = 0.5; } 
            else { btn5050.disabled = false; btn5050.style.opacity = 1; btn5050.dataset.used = "false"; }
        }
        function checkAnswer(idx, correct, btn) {
            if(isLocked) return; isLocked = true;
            if (idx === correct) {
                btn.classList.add('correct'); try { document.getElementById('sound-correct').play(); } catch(e){}
                setTimeout(() => {
                    const qs = document.getElementById('quiz-screen'); qs.classList.remove('slide-center'); qs.classList.add('slide-out-left');
                    setTimeout(() => { qs.classList.add('is-hidden'); nextLevel(); }, 800);
                }, 2000);
            } else {
                btn.classList.add('incorrect'); document.querySelectorAll('.answer-btn')[correct].classList.add('correct');
                try { document.getElementById('sound-wrong').play(); } catch(e){} setTimeout(() => gameOver(false), 2500);
            }
        }
        function gameOver(isWin) {
            stopShaking();
            let prize = "0"; let safeIndex = -1; const reachedIndex = currentQIndex - 1;
            if (isWin) prize = moneyLevels[moneyLevels.length - 1];
            else { for(let i = safeLevels.length - 1; i >= 0; i--) { if (reachedIndex >= safeLevels[i]) { safeIndex = safeLevels[i]; break; } } if (safeIndex !== -1) prize = moneyLevels[safeIndex]; }
            let data = JSON.parse(localStorage.getItem('altp_ranking') || '[]');
            data.push({ name: currentPlayer, score: `${isWin ? currentQuestions.length : currentQIndex}/${currentQuestions.length}`, money: prize });
            data.sort((a, b) => parseInt(b.money.replace(/\./g,'')) - parseInt(a.money.replace(/\./g,'')));
            localStorage.setItem('altp_ranking', JSON.stringify(data));
            
            const resOverlay = document.getElementById('result-overlay'); const titleEl = document.getElementById('res-title');
            if (isWin) { titleEl.textContent = "V√î ƒê·ªäCH!"; titleEl.style.color = "#00ff00"; titleEl.style.textShadow = "0 0 20px #00ff00"; } 
            else { titleEl.textContent = "D·ª™NG CU·ªòC CH∆†I"; titleEl.style.color = "#ff3333"; titleEl.style.textShadow = "0 0 20px #ff0000"; }
            
            document.getElementById('res-name').textContent = currentPlayer; 
            document.getElementById('res-score').textContent = `K·∫øt qu·∫£: ƒê√∫ng ${isWin ? currentQuestions.length : currentQIndex} c√¢u`;
            document.getElementById('res-money').textContent = prize + " VNƒê";
            document.getElementById('quiz-screen').classList.add('is-hidden'); resOverlay.classList.remove('is-hidden');
            document.getElementById('btn-5050').dataset.used = "false";
        }
        function use5050() {
            const btn = document.getElementById('btn-5050'); if(isLocked || btn.disabled) return;
            const q = currentQuestions[currentQIndex]; const btns = document.querySelectorAll('.answer-btn');
            let wrongs = [0,1,2,3].filter(i => i !== q.c).sort(()=>Math.random()-0.5);
            wrongs.slice(0,2).forEach(i => btns[i].classList.add('removed'));
            btn.disabled = true; btn.style.opacity = 0.5; btn.dataset.used = "true";
        }
    </script>
</body>
</html>
